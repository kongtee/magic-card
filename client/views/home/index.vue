<template>
    <FlexBox justify="space-between" align="flex-start" class='home-page'>
        <div class="card card-change">
            <FlexBox class="card-change-cate" justify="flex-start" dir="colomn">
                <el-divider class="header">面值：120</el-divider>
                <ul class="card-change-cate-list">
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('1789044233')">
                            <img src="../../assets/images/120.jpg" />
                            <div class="card-change-cate-info">1789044233</div>
                        </a>
                    </li>
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('543784531')">
                            <img src="../../assets/images/120.jpg" />
                            <div class="card-change-cate-info">543784531</div>
                        </a>
                    </li>
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('542861040')">
                            <img src="../../assets/images/120.jpg" />
                            <div class="card-change-cate-info">542861040</div>
                        </a>
                    </li>
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('541800121')">
                            <img src="../../assets/images/120.jpg" />
                            <div class="card-change-cate-info">541800121</div>
                        </a>
                    </li>
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('514707067')">
                            <img src="../../assets/images/120.jpg" />
                            <div class="card-change-cate-info">514707067</div>
                        </a>
                    </li>
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('514573207')">
                            <img src="../../assets/images/120.jpg" />
                            <div class="card-change-cate-info">514573207</div>
                        </a>
                    </li>
                </ul>
            </FlexBox>
            <FlexBox class="card-change-cate" justify="flex-start" dir="colomn">
                <el-divider class="header">面值：130</el-divider>
                <ul class="card-change-cate-list">
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('778457041')">
                            <img src="../../assets/images/130.jpg" />
                            <div class="card-change-cate-info">778457041</div>
                        </a>
                    </li>
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('2477188288')">
                            <img src="../../assets/images/130.jpg" />
                            <div class="card-change-cate-info">2477188288</div>
                        </a>
                    </li>
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('1641820550')">
                            <img src="../../assets/images/130.jpg" />
                            <div class="card-change-cate-info">1641820550</div>
                        </a>
                    </li>
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('528497145')">
                            <img src="../../assets/images/130.jpg" />
                            <div class="card-change-cate-info">528497145</div>
                        </a>
                    </li>
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('522451148')">
                            <img src="../../assets/images/130.jpg" />
                            <div class="card-change-cate-info">522451148</div>
                        </a>
                    </li>
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('1979288691')">
                            <img src="../../assets/images/130.jpg" />
                            <div class="card-change-cate-info">1979288691</div>
                        </a>
                    </li>
                </ul>
            </FlexBox>
            <FlexBox class="card-change-cate" justify="flex-start" dir="colomn">
                <el-divider class="header">面值：150</el-divider>
                <ul class="card-change-cate-list">
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('1073895986')">
                            <img src="../../assets/images/150.jpg" />
                            <div class="card-change-cate-info">1073895986</div>
                        </a>
                    </li>
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('193071964')">
                            <img src="../../assets/images/150.jpg" />
                            <div class="card-change-cate-info">193071964</div>
                        </a>
                    </li>
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('1419917133')">
                            <img src="../../assets/images/150.jpg" />
                            <div class="card-change-cate-info">1419917133</div>
                        </a>
                    </li>
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('194628941')">
                            <img src="../../assets/images/150.jpg" />
                            <div class="card-change-cate-info">194628941</div>
                        </a>
                    </li>
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('514259769')">
                            <img src="../../assets/images/150.jpg" />
                            <div class="card-change-cate-info">514259769</div>
                        </a>
                    </li>
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('2655482818')">
                            <img src="../../assets/images/150.jpg" />
                            <div class="card-change-cate-info">2655482818</div>
                        </a>
                    </li>
                </ul>
            </FlexBox>
            <FlexBox class="card-change-cate" justify="flex-start" dir="colomn">
                <el-divider class="header">面值：240</el-divider>
                <ul class="card-change-cate-list">
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('1303376323')">
                            <img src="../../assets/images/150.jpg" />
                            <div class="card-change-cate-info">1303376323</div>
                        </a>
                    </li>
                </ul>
            </FlexBox>
            <FlexBox class="card-change-cate" justify="flex-start" dir="colomn">
                <el-divider class="header">面值：280</el-divider>
                <ul class="card-change-cate-list">
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('79767246')">
                            <img src="../../assets/images/150.jpg" />
                            <div class="card-change-cate-info">79767246</div>
                        </a>
                    </li>
                </ul>
            </FlexBox>
            <FlexBox class="card-change-cate" justify="flex-start" dir="colomn">
                <el-divider class="header">面值：320</el-divider>
                <ul class="card-change-cate-list">
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('1104871723')">
                            <img src="../../assets/images/150.jpg" />
                            <div class="card-change-cate-info">1104871723</div>
                        </a>
                    </li>
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('2524741979')">
                            <img src="../../assets/images/150.jpg" />
                            <div class="card-change-cate-info">2524741979</div>
                        </a>
                    </li>
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('1993722780')">
                            <img src="../../assets/images/150.jpg" />
                            <div class="card-change-cate-info">1993722780</div>
                        </a>
                    </li>
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('2322498966')">
                            <img src="../../assets/images/150.jpg" />
                            <div class="card-change-cate-info">2322498966</div>
                        </a>
                    </li>
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('2387838358')">
                            <img src="../../assets/images/150.jpg" />
                            <div class="card-change-cate-info">2387838358</div>
                        </a>
                    </li>
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('1084949844')">
                            <img src="../../assets/images/150.jpg" />
                            <div class="card-change-cate-info">1084949844</div>
                        </a>
                    </li>
                </ul>
            </FlexBox>
            <FlexBox class="card-change-cate" justify="flex-start" dir="colomn">
                <el-divider class="header">面值：340</el-divider>
                <ul class="card-change-cate-list">
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('1346949072')">
                            <img src="../../assets/images/150.jpg" />
                            <div class="card-change-cate-info">1346949072</div>
                        </a>
                    </li>
                </ul>
            </FlexBox>
            <FlexBox class="card-change-cate" justify="flex-start" dir="colomn">
                <el-divider class="header">面值：420</el-divider>
                <ul class="card-change-cate-list">
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('1737894005')">
                            <img src="../../assets/images/150.jpg" />
                            <div class="card-change-cate-info">1737894005</div>
                        </a>
                    </li>
                </ul>
            </FlexBox>
            <FlexBox class="card-change-cate" justify="flex-start" dir="colomn">
                <el-divider class="header">面值：480</el-divider>
                <ul class="card-change-cate-list">
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('1571521868')">
                            <img src="../../assets/images/150.jpg" />
                            <div class="card-change-cate-info">1571521868</div>
                        </a>
                    </li>
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('154561484')">
                            <img src="../../assets/images/150.jpg" />
                            <div class="card-change-cate-info">154561484</div>
                        </a>
                    </li>
                </ul>
            </FlexBox>
            <FlexBox class="card-change-cate" justify="flex-start" dir="colomn">
                <el-divider class="header">面值：588</el-divider>
                <ul class="card-change-cate-list">
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('52063115')">
                            <img src="../../assets/images/150.jpg" />
                            <div class="card-change-cate-info">52063115</div>
                        </a>
                    </li>
                </ul>
            </FlexBox>
            <FlexBox class="card-change-cate" justify="flex-start" dir="colomn">
                <el-divider class="header">面值：610</el-divider>
                <ul class="card-change-cate-list">
                    <li class="card-change-cate-item">
                        <a href="javascript:void(0);" @click="onOpenQQ('1943859405')">
                            <img src="../../assets/images/150.jpg" />
                            <div class="card-change-cate-info">1943859405</div>
                        </a>
                    </li>
                </ul>
            </FlexBox>
        </div>
        <Card class="card">
            <FlexBox justify="flex-start">    
                <el-input class="qq-input" placeholder="请输入QQ号" v-model="qq"></el-input>
                <el-button icon="el-icon-search" circle @click="onOpenQQ(qq)"></el-button>
                <el-button type="primary" icon="el-icon-search" @click="onSearchQQ">搜索</el-button>
            </FlexBox>
            <div class="content">
                <el-tabs type="border-card">
                    <el-tab-pane label="发行套卡">
                        <ul>
                            <li>
                                <el-divider>难度系数 ★</el-divider>
                                <ul class="card-list">
                                    <template v-for="card in publishingStars.oneStars">
                                        <li v-if="card.num > 0" class="card-item haven" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                            <span>{{card.num}}</span>
                                        </li>
                                        <li v-else class="card-item" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                        </li>
                                    </template>
                                </ul>
                            </li>
                            <li>
                                <el-divider>难度系数 ★★</el-divider>
                                <ul class="card-list">
                                    <template v-for="card in publishingStars.twoStars">
                                        <li v-if="card.num > 0" class="card-item haven" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                            <span>{{card.num}}</span>
                                        </li>
                                        <li v-else class="card-item" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                        </li>
                                    </template>
                                </ul>
                            </li>
                            <li>
                                <el-divider>难度系数 ★★★</el-divider>
                                <ul class="card-list">
                                    <template v-for="card in publishingStars.threeStars">
                                        <li v-if="card.num > 0" class="card-item haven" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                            <span>{{card.num}}</span>
                                        </li>
                                        <li v-else class="card-item" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                        </li>
                                    </template>
                                </ul>
                            </li>
                            <li>
                                <el-divider>难度系数 ★★★★</el-divider>
                                <ul class="card-list">
                                    <template v-for="card in publishingStars.fourStars">
                                        <li v-if="card.num > 0" class="card-item haven" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                            <span>{{card.num}}</span>
                                        </li>
                                        <li v-else class="card-item" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                        </li>
                                    </template>
                                </ul>
                            </li>
                            <li>
                                <el-divider>难度系数 ★★★★★</el-divider>
                                <ul class="card-list">
                                    <template v-for="card in publishingStars.fiveStars">
                                        <li v-if="card.num > 0" class="card-item haven" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                            <span>{{card.num}}</span>
                                        </li>
                                        <li v-else class="card-item" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                        </li>
                                    </template>
                                </ul>
                            </li>
                        </ul>
                    </el-tab-pane>
                    <el-tab-pane label="下架套卡">
                        <ul>
                            <li>
                                <el-divider>难度系数 ★</el-divider>
                                <ul class="card-list">
                                    <template v-for="card in soldoutStars.oneStars">
                                        <li v-if="card.num > 0" class="card-item haven" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                            <span>{{card.num}}</span>
                                        </li>
                                        <li v-else class="card-item" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                        </li>
                                    </template>
                                </ul>
                            </li>
                            <li>
                                <el-divider>难度系数 ★★</el-divider>
                                <ul class="card-list">
                                    <template v-for="card in soldoutStars.twoStars">
                                        <li v-if="card.num > 0" class="card-item haven" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                            <span>{{card.num}}</span>
                                        </li>
                                        <li v-else class="card-item" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                        </li>
                                    </template>
                                </ul>
                            </li>
                            <li>
                                <el-divider>难度系数 ★★★</el-divider>
                                <ul class="card-list">
                                    <template v-for="card in soldoutStars.threeStars">
                                        <li v-if="card.num > 0" class="card-item haven" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                            <span>{{card.num}}</span>
                                        </li>
                                        <li v-else class="card-item" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                        </li>
                                    </template>
                                </ul>
                            </li>
                            <li>
                                <el-divider>难度系数 ★★★★</el-divider>
                                <ul class="card-list">
                                    <template v-for="card in soldoutStars.fourStars">
                                        <li v-if="card.num > 0" class="card-item haven" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                            <span>{{card.num}}</span>
                                        </li>
                                        <li v-else class="card-item" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                        </li>
                                    </template>
                                </ul>
                            </li>
                            <li>
                                <el-divider>难度系数 ★★★★★</el-divider>
                                <ul class="card-list">
                                    <template v-for="card in soldoutStars.fiveStars">
                                        <li v-if="card.num > 0" class="card-item haven" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                            <span>{{card.num}}</span>
                                        </li>
                                        <li v-else class="card-item" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                        </li>
                                    </template>
                                </ul>
                            </li>
                        </ul>
                    </el-tab-pane>
                    <el-tab-pane label="闪卡">
                        <ul>
                            <li>
                                <el-divider>难度系数 ★</el-divider>
                                <ul class="card-list">
                                    <template v-for="card in blinkStars.oneStars">
                                        <li v-if="card.num > 0" class="card-item haven" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                            <span>{{card.num}}</span>
                                        </li>
                                        <li v-else class="card-item" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                        </li>
                                    </template>
                                </ul>
                            </li>
                            <li>
                                <el-divider>难度系数 ★★</el-divider>
                                <ul class="card-list">
                                    <template v-for="card in blinkStars.twoStars">
                                        <li v-if="card.num > 0" class="card-item haven" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                            <span>{{card.num}}</span>
                                        </li>
                                        <li v-else class="card-item" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                        </li>
                                    </template>
                                </ul>
                            </li>
                            <li>
                                <el-divider>难度系数 ★★★</el-divider>
                                <ul class="card-list">
                                    <template v-for="card in blinkStars.threeStars">
                                        <li v-if="card.num > 0" class="card-item haven" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                            <span>{{card.num}}</span>
                                        </li>
                                        <li v-else class="card-item" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                        </li>
                                    </template>
                                </ul>
                            </li>
                            <li>
                                <el-divider>难度系数 ★★★★</el-divider>
                                <ul class="card-list">
                                    <template v-for="card in blinkStars.fourStars">
                                        <li v-if="card.num > 0" class="card-item haven" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                            <span>{{card.num}}</span>
                                        </li>
                                        <li v-else class="card-item" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                        </li>
                                    </template>
                                </ul>
                            </li>
                            <li>
                                <el-divider>难度系数 ★★★★★</el-divider>
                                <ul class="card-list">
                                    <template v-for="card in blinkStars.fiveStars">
                                        <li v-if="card.num > 0" class="card-item haven" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                            <span>{{card.num}}</span>
                                        </li>
                                        <li v-else class="card-item" :key="card.id">
                                            <a href="javascript:void(0)">{{card.name}}</a>
                                        </li>
                                    </template>
                                </ul>
                            </li>
                        </ul>
                    </el-tab-pane>
                </el-tabs>
            </div>
        </Card>
    </FlexBox>
</template>

<style lang='less'>
    @import '../../assets/common/var';

    .home-page {
        background-color: @body-background-color;
        margin: 20px;

        .card {
            .qq-input {
                width: 200px;
                margin-right: 10px;
            }

            .content {
                margin-top: 20px;

                .card-list {
                    display: flex;
                    flex-wrap: wrap;
                    justify-content: flex-start;

                    .card-item {
                        margin: 5px;
                        width: 100px;

                        a {
                            display: block;
                        }
                    }

                    .card-item.haven {
                        background-color: rgb(166, 205, 81);
                        position: relative;

                        span {
                            position: absolute;
                            right: -4px;
                            background-color: red;
                            width: 16px;
                            height: 16px;
                            line-height: 16px;
                            text-align: center;
                            border-radius: 8px;
                            top: -4px;
                            color: #fff;
                        }
                    }
                }
            }
        }

        .card-change {
            display: flex;
            flex-direction: column;

            .card-change-cate {
                .header {
                    .el-divider__text {
                        color: @body-color;
                        font-size: 16px;
                        font-weight: bold;
                    }
                }

                .card-change-cate-list {
                    display: flex;

                    .card-change-cate-item {
                        width: 50px;
                        position: relative;
                        margin-right: 8px;

                        .card-change-cate-info {
                            display: none;
                            position: absolute;
                            left: 0;
                            right: 0;
                            top: 0;
                            bottom: 0;
                            color: red;
                            font-weight: bold;
                            text-align: center;
                            line-height: 150px;
                            font-size: 15px;
                        }
                    }
                }
            }
        }
    }
</style>

<script>
    import Card from '../../components/common/Card.vue';
    import FlexBox from '../../components/common/FlexBox.vue';
    import axios from 'axios';
    import themeInfo from '../../common/themeInfo';

    export default {
        components: {
            Card,
            FlexBox
        },
        data() {
            return {
                qq: '',
                publishings: [],   // 发行套卡
                soldouts: [],      // 下架套卡
                blinks: [],        // 闪卡
                publishingStars: {  // 发行套卡
                    oneStars: [],   // 一星
                    twoStars: [],   // 二星
                    threeStars: [], // 三星
                    fourStars: [],  // 四星
                    fiveStars: []   // 五星
                },
                soldoutStars: {     // 下架套卡
                    oneStars: [],   // 一星
                    twoStars: [],   // 二星
                    threeStars: [], // 三星
                    fourStars: [],  // 四星
                    fiveStars: []   // 五星
                },
                blinkStars: {       // 闪卡
                    oneStars: [],   // 一星
                    twoStars: [],   // 二星
                    threeStars: [], // 三星
                    fourStars: [],  // 四星
                    fiveStars: []   // 五星
                }
            }
        },
        mounted() {
            this.init();
        },
        methods: {
            getUserInfo() {
                const params = {
                    cmd: 'card_mini_get'
                }
                axios.get('http://localhost:8360/cardshow', {params})
                    .then(res => {
                        const data = res.data && res.data.QQHOME && res.data.QQHOME.Node || [];
                        console.log('response：', data);
                        this.transStatus(themeInfo, data);
                    })
                    .catch(error => {
                        throw error;
                    });
            },
            init() {
                this.getUserInfo();
            },
            /**
             * 处理星级分类
             */
            transStars(parent, card) {
                switch(card.diff) {
                    case 1:
                        parent.oneStars.unshift(card);
                        break;
                    case 2:
                        parent.twoStars.unshift(card);
                        break;
                    case 3:
                        parent.threeStars.unshift(card);
                        break;
                    case 4:
                        parent.fourStars.unshift(card);
                        break;
                    case 5:
                        parent.fiveStars.unshift(card);
                        break;
                }
            },
            /**
             * 处理星级
             */
            transStatus(themeInfo, cardData) {
                let index = 0;
                for(let card of themeInfo) {
                    const len = cardData.length;
                    if (len > 0 && index < len && card.id == cardData[index].theme_id) {
                        card.num = cardData[index].num;
                        index++;
                    } else {
                        card.num = 0;
                    } 

                    switch(card.type) {
                        case 0: 
                            // this.publishings.push(card);
                            this.transStars(this.publishingStars, card);
                            break;
                        case 1: 
                            // this.soldouts.push(card);
                            this.transStars(this.soldoutStars, card);
                            break;
                        case 9: 
                            // this.blinks.push(card);
                            this.transStars(this.blinkStars, card);
                            break;
                    }
                }
            },
            /**
             * 打开QQ好友
             */
            onOpenQQ(qq) {
                this.openQQFriend(qq);
            },
            /**
             * 打开好友页面
             */
            openQQFriend(qq) {
                const url = `http://appimg2.qq.com/card/index_v3.html#opuin=${qq}`;
                console.log(url);
                window.open(url);
            },
            /**
             * 查找QQ好友
             */
            onSearchQQ() {
                let param = {
                    cmd: 'card_user_mainpage',
                    token: '@0irueCUkI',
                    sid: 'o0079959261',
                    mkfrom: 'mkqz',
                    uin: '79959261',
                    opuin: this.qq
                }
                axios.get('http://localhost:8360/logout', param)
                    .then(response => {
                        console.log('response：',response);
                        let data = response && response.data || {};
                        if (data.RspHeader && data.RspHeader.ErrNo == 200) {
                            
                        } else {
                            throw data;
                        }
                    })
                    .catch(error => {
                        throw error;
                    });
            }
        }
    }
</script>

